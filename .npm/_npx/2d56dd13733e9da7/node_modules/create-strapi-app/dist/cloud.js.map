{"version":3,"file":"cloud.js","sources":["../src/cloud.ts"],"sourcesContent":["import inquirer from 'inquirer';\nimport { cli as cloudCli, services as cloudServices } from '@strapi/cloud-cli';\nimport parseToChalk from './utils/parse-to-chalk';\n\ninterface CloudError {\n  response: {\n    status: number;\n    data: string | object;\n  };\n}\n\nfunction assertCloudError(e: unknown): asserts e is CloudError {\n  if ((e as CloudError).response === undefined) {\n    throw Error('Expected CloudError');\n  }\n}\n\nexport async function handleCloudLogin(): Promise<void> {\n  let cloudApiConfig;\n  const logger = cloudServices.createLogger({\n    silent: false,\n    debug: process.argv.includes('--debug'),\n    timestamp: false,\n  });\n  const cloudApiService = await cloudServices.cloudApiFactory({ logger });\n  const defaultErrorMessage =\n    'An error occurred while trying to interact with Strapi Cloud. Use strapi deploy command once the project is generated.';\n\n  try {\n    const { data: config } = await cloudApiService.config();\n    cloudApiConfig = config;\n    logger.log(parseToChalk(config.projectCreation.introText));\n  } catch (e: unknown) {\n    logger.debug(e);\n    logger.error(defaultErrorMessage);\n    return;\n  }\n  const { userChoice } = await inquirer.prompt<{ userChoice: string }>(\n    cloudApiConfig.projectCreation?.userChoice || [\n      {\n        type: 'list',\n        name: 'userChoice',\n        message: `Please log in or sign up.`,\n        choices: ['Login/Sign up', 'Skip'],\n      },\n    ]\n  );\n\n  if (!userChoice.toLowerCase().includes('skip')) {\n    const cliContext = {\n      logger,\n      cwd: process.cwd(),\n      ...(cloudApiConfig.projectCreation?.reference && {\n        promptExperiment: cloudApiConfig.projectCreation?.reference,\n      }),\n    };\n\n    try {\n      await cloudCli.login.action(cliContext);\n    } catch (e: Error | CloudError | unknown) {\n      logger.debug(e);\n      try {\n        assertCloudError(e);\n        if (e.response.status === 403) {\n          const message =\n            typeof e.response.data === 'string'\n              ? e.response.data\n              : 'We are sorry, but we are not able to log you into Strapi Cloud at the moment.';\n          logger.warn(message);\n          return;\n        }\n      } catch (e) {\n        /* empty */\n      }\n      logger.error(defaultErrorMessage);\n    }\n  }\n}\n"],"names":["assertCloudError","e","response","undefined","Error","handleCloudLogin","cloudApiConfig","logger","cloudServices","createLogger","silent","debug","process","argv","includes","timestamp","cloudApiService","cloudApiFactory","defaultErrorMessage","data","config","log","parseToChalk","projectCreation","introText","error","userChoice","inquirer","prompt","type","name","message","choices","toLowerCase","cliContext","cwd","reference","promptExperiment","cloudCli","login","action","status","warn"],"mappings":";;;;;;AAWA,SAASA,iBAAiBC,CAAU,EAAA;AAClC,IAAA,IAAI,CAACA,CAAiBC,QAAQ,KAAKC,SAAW,EAAA;AAC5C,QAAA,MAAMC,KAAM,CAAA,qBAAA,CAAA;AACd;AACF;AAEO,eAAeC,gBAAAA,GAAAA;IACpB,IAAIC,cAAAA;IACJ,MAAMC,MAAAA,GAASC,iBAAcC,CAAAA,YAAY,CAAC;QACxCC,MAAQ,EAAA,KAAA;AACRC,QAAAA,KAAAA,EAAOC,OAAQC,CAAAA,IAAI,CAACC,QAAQ,CAAC,SAAA,CAAA;QAC7BC,SAAW,EAAA;AACb,KAAA,CAAA;AACA,IAAA,MAAMC,eAAkB,GAAA,MAAMR,iBAAcS,CAAAA,eAAe,CAAC;AAAEV,QAAAA;AAAO,KAAA,CAAA;AACrE,IAAA,MAAMW,mBACJ,GAAA,wHAAA;IAEF,IAAI;AACF,QAAA,MAAM,EAAEC,IAAMC,EAAAA,MAAM,EAAE,GAAG,MAAMJ,gBAAgBI,MAAM,EAAA;QACrDd,cAAiBc,GAAAA,MAAAA;AACjBb,QAAAA,MAAAA,CAAOc,GAAG,CAACC,YAAAA,CAAaF,MAAOG,CAAAA,eAAe,CAACC,SAAS,CAAA,CAAA;AAC1D,KAAA,CAAE,OAAOvB,CAAY,EAAA;AACnBM,QAAAA,MAAAA,CAAOI,KAAK,CAACV,CAAAA,CAAAA;AACbM,QAAAA,MAAAA,CAAOkB,KAAK,CAACP,mBAAAA,CAAAA;AACb,QAAA;AACF;IACA,MAAM,EAAEQ,UAAU,EAAE,GAAG,MAAMC,QAASC,CAAAA,MAAM,CAC1CtB,cAAAA,CAAeiB,eAAe,EAAEG,UAAc,IAAA;AAC5C,QAAA;YACEG,IAAM,EAAA,MAAA;YACNC,IAAM,EAAA,YAAA;YACNC,OAAS,EAAA,CAAC,yBAAyB,CAAC;YACpCC,OAAS,EAAA;AAAC,gBAAA,eAAA;AAAiB,gBAAA;AAAO;AACpC;AACD,KAAA,CAAA;AAGH,IAAA,IAAI,CAACN,UAAWO,CAAAA,WAAW,EAAGnB,CAAAA,QAAQ,CAAC,MAAS,CAAA,EAAA;AAC9C,QAAA,MAAMoB,UAAa,GAAA;AACjB3B,YAAAA,MAAAA;AACA4B,YAAAA,GAAAA,EAAKvB,QAAQuB,GAAG,EAAA;YAChB,GAAI7B,cAAAA,CAAeiB,eAAe,EAAEa,SAAa,IAAA;gBAC/CC,gBAAkB/B,EAAAA,cAAAA,CAAeiB,eAAe,EAAEa;;AAEtD,SAAA;QAEA,IAAI;AACF,YAAA,MAAME,YAASC,CAAAA,KAAK,CAACC,MAAM,CAACN,UAAAA,CAAAA;AAC9B,SAAA,CAAE,OAAOjC,CAAiC,EAAA;AACxCM,YAAAA,MAAAA,CAAOI,KAAK,CAACV,CAAAA,CAAAA;YACb,IAAI;gBACFD,gBAAiBC,CAAAA,CAAAA,CAAAA;AACjB,gBAAA,IAAIA,CAAEC,CAAAA,QAAQ,CAACuC,MAAM,KAAK,GAAK,EAAA;AAC7B,oBAAA,MAAMV,OACJ,GAAA,OAAO9B,CAAEC,CAAAA,QAAQ,CAACiB,IAAI,KAAK,QAAA,GACvBlB,CAAEC,CAAAA,QAAQ,CAACiB,IAAI,GACf,+EAAA;AACNZ,oBAAAA,MAAAA,CAAOmC,IAAI,CAACX,OAAAA,CAAAA;AACZ,oBAAA;AACF;AACF,aAAA,CAAE,OAAO9B,CAAG,EAAA;AACV;AAEFM,YAAAA,MAAAA,CAAOkB,KAAK,CAACP,mBAAAA,CAAAA;AACf;AACF;AACF;;;;"}